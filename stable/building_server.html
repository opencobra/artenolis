

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Building Artenolis Server &mdash; ARTENOLIS</title>
  

  
  
    <link rel="shortcut icon" href="_static/logo_artenolis.ico"/>
  
  
    <link rel="apple-touch-icon" sizes="180x180" href="_static/img/apple-touch-icon.png">
  
  
    <link rel="icon" type="image/png" sizes="32x32" href="_static/img/favicon-32x32.png">
  
  
    <link rel="icon" type="image/png" sizes="16x16" href="_static/img/favicon-16x16.png">
  
  
    <link rel="mask-icon" href="_static/img/safari-pinned-tab.svg" color="#5bbad5">
  
  
    <link rel="manifest" href="_static/json/manifest.json">
  
  
    <meta name="msapplication-config" content="_static/browserconfig.xml">
  
  <meta name="theme-color" content="#ffffff">


  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
  <script src="https://code.jquery.com/jquery-1.11.2.min.js"></script>
  <script src="_static/js/jquery.easy-autocomplete.min.js" type="text/javascript" ></script>

    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
  
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700' rel='stylesheet' type='text/css'>
  <link href="_static/css/easy-autocomplete.min.css" rel="stylesheet" type="text/css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">

  
  
    

  

  
  
    <link rel="stylesheet" href="_static/css/cobra.css" type="text/css" />
  

  

  
        <link rel="index" title="Index"
              href="genindex.html"/>
        <link rel="search" title="Search" href="search.html"/>
    <link rel="top" title="ARTENOLIS" href="index.html"/>
        <link rel="up" title="Setup" href="setup.html"/>
        <link rel="next" title="Configurations" href="configurations.html"/>
        <link rel="prev" title="Software" href="software.html"/> 

  
  <script src="_static/js/modernizr.min.js"></script>
</head>

<body class="wy-body-for-nav" role="document">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="index.html">
          

          
            
            <img src="https://raw.githubusercontent.com/opencobra/artenolis/master/docs/source/_static/img/logo_artenolis.png" class="logo" alt="artenolis logo"/>
          
          </a>
          <h1>ARTENOLIS</h1>

          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" id="simple"/>
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
    <script>
    	var options = {

		url: "_static/json/functions.json",

		getValue: "name",

		list: {
            onKeyEnterEvent: function(item) {
                    return "_static/../" + item.website_url
            },
            maxNumberOfElements: 25,
			match: {
					enabled: true,
			},
            sort: {
			    enabled: true
		    }
		},

    	template: {
	    	type: "custom",
		    method: function(value, item) {
                return "<span><a href='search.html?q=" + item.name + "&check_keywords=yes&area=default'>" + value + "</a>" + "<a href='_static/../" + item.website_url + "' ><img src='_static/link.svg'/></a></span>";
		    }
	    },

		theme: "square"

	};

	$("#simple").easyAutocomplete(options);


    </script>
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
              <ul class="current">
                  <li class="toctree-l1"><a class="reference internal" href="index.html">Home</a></li>
              </ul>
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="index.html">Home</a></li>
<li class="toctree-l1"><a class="reference internal" href="getstarted.html">How to get started</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="setup.html">Setup</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="overview.html">Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="architecture.html">Architecture</a></li>
<li class="toctree-l2"><a class="reference internal" href="software.html">Software</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Building Artenolis Server</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#initial-setup-of-jenkins">Initial setup of Jenkins</a></li>
<li class="toctree-l3"><a class="reference internal" href="#setting-up-jenkins-for-artenolis">Setting up Jenkins for Artenolis</a></li>
<li class="toctree-l3"><a class="reference internal" href="#automatically-starting-jenkins-on-boot">Automatically starting Jenkins on boot</a></li>
<li class="toctree-l3"><a class="reference internal" href="#enabling-https-for-public-server">Enabling HTTPS for public server</a></li>
<li class="toctree-l3"><a class="reference internal" href="#automating-backup-of-jenkins-configuration">Automating backup of Jenkins configuration</a></li>
<li class="toctree-l3"><a class="reference internal" href="#keeping-track-of-important-login-credentials">Keeping track of important login credentials</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="configurations.html">Configurations</a></li>
<li class="toctree-l1"><a class="reference internal" href="projects.html">Projects</a></li>
<li class="toctree-l1"><a class="reference internal" href="funding.html">Funding</a></li>
<li class="toctree-l1"><a class="reference internal" href="acronyms.html">Acronyms</a></li>
</ul>

          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">ARTENOLIS</a>
        
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="setup.html">Setup</a> &raquo;</li>
        
      <li>Building Artenolis Server</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="https://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="building-artenolis-server">
<span id="building-server"></span><h1>Building Artenolis Server<a class="headerlink" href="#building-artenolis-server" title="Permalink to this headline">¶</a></h1>
<p>(work in progress 2020-11-10)</p>
<p>The following ‘howto’ explains how to setup a Artenolis server starting with a clean Ubuntu 20.04 distribution. Before starting you should have ready the credentials
to the ‘bot’ github user (eg cobratoolboxbot).</p>
<p>If running from a Virtual Machine, set RAM 4GB or higher, disk space 24GB or higher.</p>
<p>When installing Ubuntu 20.04, choose a minimal install with no 3rd party software.
Set the primary user to ‘jenkins’ with a strong password
and make note of the password. Set the hostname ‘artenolis’ (or your preferred host name).</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sudo apt update
sudo apt install -y git openjdk-11-jre-headless
</pre></div>
</div>
<p>Download the LTS version of Jenkins from <a class="reference external" href="https://www.jenkins.io">https://www.jenkins.io</a>. Choose the Generic Java Package (war) download. This howto has been written for version 2.249.2 LTS which can be downloaded at
<a class="reference external" href="https://get.jenkins.io/war-stable/2.249.3/jenkins.war">https://get.jenkins.io/war-stable/2.249.3/jenkins.war</a> .</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>wget https://get.jenkins.io/war-stable/2.249.3/jenkins.war
</pre></div>
</div>
<p>To run Jenkins using the built in Jetty web server:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>java -jar jenkins.war
</pre></div>
</div>
<p>It takes about a minute to start. Logs are echoed to standard output. When Jenkins is finished starting, at the end of the logs you will see the random admin password. Make record of this. The admin password can be retrieve later from file /home/jenkins/.jenkins/secrets/initialAdminPassword. Example:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>Jenkins initial setup is required. An admin user has been created and a password generated.
Please use the following password to proceed to installation:

31032562bf8c4f96a0577790f79c17cc

This may also be found at: /home/jenkins/.jenkins/secrets/initialAdminPassword
</pre></div>
</div>
<div class="section" id="initial-setup-of-jenkins">
<h2>Initial setup of Jenkins<a class="headerlink" href="#initial-setup-of-jenkins" title="Permalink to this headline">¶</a></h2>
<p>Open browser at <a class="reference external" href="http://localhost:8080">http://localhost:8080</a> and enter the admin password when prompted. Choose “Install Suggested Plugins”. Allow a few minutes for the plugins to install.</p>
<a class="reference internal image-reference" href="_images/screenshot_jenkins_setup_2.png"><img alt="ARTENOLIS setup: installing Jenkins plugins 1/2" class="align-center" src="_images/screenshot_jenkins_setup_2.png" style="width: 750px;" /></a>
<a class="reference internal image-reference" href="_images/screenshot_jenkins_setup_3.png"><img alt="ARTENOLIS setup: installing Jenkins plugins 2/2" class="align-center" src="_images/screenshot_jenkins_setup_3.png" style="width: 750px;" /></a>
<p>For first admin user chose username ‘jenkins’, full name ‘jenkins’ and use your own email address.</p>
<a class="reference internal image-reference" href="_images/screenshot_jenkins_first_admin_user.png"><img alt="ARTENOLIS setup: creating first admin user" class="align-center" src="_images/screenshot_jenkins_first_admin_user.png" style="width: 750px;" /></a>
<p>For the ‘Instance Configuration’ leave at default <a class="reference external" href="http://localhost:8080">http://localhost:8080</a> for the moment. Click ‘Save and Finish’. You are now ready to setup Jenkins for the Artenolis configuration.</p>
<a class="reference internal image-reference" href="_images/screenshot_jenkins_instance_config.png"><img alt="ARTENOLIS setup: installing Jenkins instance config" class="align-center" src="_images/screenshot_jenkins_instance_config.png" style="width: 750px;" /></a>
</div>
<div class="section" id="setting-up-jenkins-for-artenolis">
<h2>Setting up Jenkins for Artenolis<a class="headerlink" href="#setting-up-jenkins-for-artenolis" title="Permalink to this headline">¶</a></h2>
<p>Artenolis requires the ‘Blue Ocean’ plugin.  Go to Jenkins -&gt; Manage Jenkins -&gt; Manage Plugins -&gt; Available tab. Search for “Blue Ocean”.</p>
<a class="reference internal image-reference" href="_images/screenshot_jenkins_blueocean_1_cropped.png"><img alt="ARTENOLIS setup: installing Jenkins Blue Ocean plugin 1/3" class="align-center" src="_images/screenshot_jenkins_blueocean_1_cropped.png" style="width: 750px;" /></a>
<p>Install plugin “Blue Ocean” aggregate plugin (near the end of the list) by selecting it and clicking on “Install without restart” button.</p>
<a class="reference internal image-reference" href="_images/screenshot_jenkins_blueocean_2_cropped.png"><img alt="ARTENOLIS setup: installing Jenkins Blue Ocean plugin 2/3" class="align-center" src="_images/screenshot_jenkins_blueocean_2_cropped.png" style="width: 750px;" /></a>
<p>“Blue Ocean” is an aggretate plugin which loads many sub-plugins. Check the “Restart Jenkins when installation is complete” checkbox to restart Jenkins which will enable the plugin. The installation procedure is likely to take a few minutes. If nothing happens after 5 minutes, try reloading the browser page. If all goes well you will be greeted with the Jenkins login screen.</p>
<a class="reference internal image-reference" href="_images/screenshot_jenkins_blueocean_3.png"><img alt="ARTENOLIS setup: installing Jenkins Blue Ocean plugin 3/3" class="align-center" src="_images/screenshot_jenkins_blueocean_3.png" style="width: 750px;" /></a>
<p>Now that the Blue Ocean plugin is install, next step is configuring the multi-pipline tests.
After restart a new “Open Blue Ocean” menu option will be on the left column menu. Click on this. Next select “New Pipeline”.</p>
<a class="reference internal image-reference" href="_images/screenshot_jenkins_blueocean_4_cropped.png"><img alt="ARTENOLIS setup: Blue Ocean multi-pipeline" class="align-center" src="_images/screenshot_jenkins_blueocean_4_cropped.png" style="width: 750px;" /></a>
<p>Select GitHub in response to ‘where do you store your code’. If you do not already have a ‘personal access token’ you can create one by clicking on the link “Create an access token here.”  This will open a new tab. Log into github as the bot user. Leave the token options as is. Set the ‘note’ field to ‘artenolis’.</p>
<a class="reference internal image-reference" href="_images/screenshot_jenkins_blueocean_5.png"><img alt="ARTENOLIS setup: Blue Ocean multi-pipeline" class="align-center" src="_images/screenshot_jenkins_blueocean_5.png" style="width: 750px;" /></a>
<p>Copy the access token, return to the Jenkins browser tab and paste in the access token. If all goes well you will see a list of organizations / repositories belonging to the bot user (if you don’t see any you may have to invite the bot user to those organizations).  Select ‘opencobra’ organization. Select cobratoolbox. Click “Create Pipeline”.</p>
</div>
<div class="section" id="automatically-starting-jenkins-on-boot">
<h2>Automatically starting Jenkins on boot<a class="headerlink" href="#automatically-starting-jenkins-on-boot" title="Permalink to this headline">¶</a></h2>
<p>Create file /home/jenkins/jenkins-start.sh and set an execute flag on it with ‘chmod a+x jenkins-start.sh’.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="ch">#!/bin/bash</span>
java -jar /home/jenkins/jenkins.war
</pre></div>
</div>
<p>Create file /etc/systemd/system/jenkins:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="o">[</span>Unit<span class="o">]</span>
<span class="nv">Description</span><span class="o">=</span>Jenkins

<span class="o">[</span>Service<span class="o">]</span>
<span class="nv">User</span><span class="o">=</span>jenkins
<span class="nv">ExecStart</span><span class="o">=</span>/home/jenkins/jenkins-start.sh

<span class="o">[</span>Install<span class="o">]</span>
<span class="nv">WantedBy</span><span class="o">=</span>multi-user.target
</pre></div>
</div>
<p>Now enable the server at boot time:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>systemctl <span class="nb">enable</span> jenkins
</pre></div>
</div>
<p>Reboot to test the auto-start.</p>
</div>
<div class="section" id="enabling-https-for-public-server">
<h2>Enabling HTTPS for public server<a class="headerlink" href="#enabling-https-for-public-server" title="Permalink to this headline">¶</a></h2>
<p>A prerequisite to this step is that your server must be accessible from the internet in port 80 and 443 and that it has been given a hostname in DNS (example king.nuigalway.ie).</p>
<p>Jenkins defaults to using port 8080. However best practise is to make this available on the default HTTPS port (443). There are several ways of achiving this. The apporach taken here use the nginx web server as a reverse-proxy to the Jenkins server.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sudo add-apt-repository ppa:certbot/certbot
sudo apt install -y nginx python3-certbot-nginx
</pre></div>
</div>
<p>Replace file /etc/nginx/sites-available/default with:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>upstream jenkins {
        server 127.0.0.1:8080 fail_timeout=0;
}

server {
        listen 80 default_server;
        listen [::]:80 default_server;

        root /var/www/html;
        index index.html index.htm index.nginx-debian.html;

        server_name artenolis.example.com;

        location / {
        proxy_set_header        Host $host:$server_port;
        proxy_set_header        X-Real-IP $remote_addr;
        proxy_set_header        X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header        X-Forwarded-Proto $scheme;
        proxy_set_header        Upgrade $http_upgrade;
        proxy_set_header        Connection &quot;upgrade&quot;;
        proxy_pass              http://jenkins;
        }
}
</pre></div>
</div>
<p>Replace ‘artenolis.example.com’ with the proper full host name of the Artenolis server, eg king.nuigalway.ie. Check config file and restart nginx:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sudo nginx -t
sudo systemctl restart nginx
</pre></div>
</div>
<p>Now run certbot to create a HTTPS certificate (again replace artenolis.example.com’ with the correct full host name).</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sudo certbot --nginx -d artenolis.example.com
</pre></div>
</div>
<p>Certbot will ask a few questions (eg agreeing to terms and conditions etc). For the final question, choose redirect all traffic to HTTPS (option 2).</p>
<p>If all goes well Jenkins will be accessable from <a class="reference external" href="https://artenolis.example.com">https://artenolis.example.com</a> (again replace the host name)</p>
<p>Reference: “Set up Jenkins on Ubuntu 18.04 with LetsEncrypt (HTTPS) using Nginx” <a class="reference external" href="https://medium.com/&#64;kerren_12230/set-up-jenkins-on-ubuntu-18-04-with-letsencrypt-https-using-nginx-7046baa276d9">https://medium.com/&#64;kerren_12230/set-up-jenkins-on-ubuntu-18-04-with-letsencrypt-https-using-nginx-7046baa276d9</a></p>
</div>
<div class="section" id="automating-backup-of-jenkins-configuration">
<h2>Automating backup of Jenkins configuration<a class="headerlink" href="#automating-backup-of-jenkins-configuration" title="Permalink to this headline">¶</a></h2>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>git clone https://github.com/sue445/jenkins-backup-script.git
</pre></div>
</div>
<p>Backup script</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="ch">#!/bin/bash</span>
<span class="c1"># Backup Artenolis Jenkins configuration</span>
<span class="c1"># Uses backup script at https://github.com/sue445/jenkins-backup-script</span>
<span class="nv">JENKINS_BACKUP</span><span class="o">=</span>/home/vmhadmin/jenkins-backup-script
<span class="nv">JENKINS_HOME</span><span class="o">=</span>/home/vmhadmin/.jenkins
<span class="nv">TS</span><span class="o">=</span><span class="sb">`</span>date +%Y%m%d-%H%M<span class="sb">`</span>
<span class="si">${</span><span class="nv">JENKINS_BACKUP</span><span class="si">}</span>/jenkins-backup.sh <span class="si">${</span><span class="nv">JENKINS_HOME</span><span class="si">}</span> <span class="si">${</span><span class="nv">JENKINS_BACKUP</span><span class="si">}</span>/jenkins-backup-<span class="si">${</span><span class="nv">TS</span><span class="si">}</span>.tar.gz &gt;<span class="p">&amp;</span> <span class="si">${</span><span class="nv">JENKINS_BACKUP</span><span class="si">}</span>/backup.log
</pre></div>
</div>
<p>Add to crontab:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>@daily /home/vmhadmin/scripts/backup-jenkins-config.sh
</pre></div>
</div>
<p>Remark: the bulk of the configuration backup are the optional Jenkins plugins. Without these the configuration is about 20kB.</p>
</div>
<div class="section" id="keeping-track-of-important-login-credentials">
<h2>Keeping track of important login credentials<a class="headerlink" href="#keeping-track-of-important-login-credentials" title="Permalink to this headline">¶</a></h2>
<p>Maintaining the Artenolis system will require keeping track of several keys and credentials. These must not be stored in a public code repository.</p>
<blockquote>
<div><ul class="simple">
<li><p>username / password for the GitHub bot user (cobtratoolboxbot)</p></li>
<li><p>personal access token for GitHub bot user</p></li>
<li><p>associated email address linked to the GitHub bot user (<a class="reference external" href="mailto:cobtratoolboxbot&#37;&#52;&#48;gmail&#46;com">cobtratoolboxbot<span>&#64;</span>gmail<span>&#46;</span>com</a>)</p></li>
<li><p>username / password of jenkins user of server</p></li>
<li><p>username / password of admin user of server</p></li>
</ul>
</div></blockquote>
</div>
</div>


           </div>
           <div class="articleComments">
            
           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="configurations.html" class="btn btn-default float-right" title="Configurations" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="software.html" class="btn btn-default" title="Software" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2020, The ARTENOLIS developers.

    </p>
  </div>
  Built with Sphinx using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  

  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'./',
            VERSION:'1.0.0',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <script type="text/javascript" src="_static/language_data.js"></script>

  


  
  
    <script type="text/javascript" src="_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>